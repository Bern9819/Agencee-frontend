<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agencee Booking</title>

  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }

    .container {
      max-width: 500px;
      margin: auto;
      padding: 20px;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      border-radius: 8px;
      margin-top: 40px;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    header img {
      width: 180px;
      height: auto;
    }

    h1 {
      font-size: 22px;
      color: #3B6C8F;
      text-align: center;
      margin-bottom: 20px;
    }

    .label {
      font-weight: bold;
      margin: 10px 0;
      display: block;
      color: #3B6C8F;
    }

    .button {
      background-color: #7759B3;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
    }

    .button:hover {
      background-color: #6A93C5;
    }

    .dropdown, .form-input {
      width: 100%;
      padding: 12px;
      border-radius: 5px;
      border: 1px solid #ddd;
      margin-bottom: 20px;
    }

    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .calendar-nav button {
      background: none;
      border: none;
      font-size: 18px;
      color: #3B6C8F;
      cursor: pointer;
    }

    .calendar-days {
      display: flex;
      justify-content: space-between;
    }

    .day {
      text-align: center;
      cursor: pointer;
      flex: 1;
    }

    .day span {
      display: block;
      color: #3B6C8F;
    }

    .day .date {
      margin-top: 5px;
      padding: 10px;
      width: 40px;
      height: 40px;
      margin: auto;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day.selected .date {
      background-color: #7759B3;
      color: #fff;
    }

    .slots-list {
      margin-top: 20px;
    }

    .slot-item {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }

    .slot-item:hover {
      background-color: #f1f1f1;
    }

    .slot-item.selected {
      background-color: #8BC6B2;
      color: #fff;
    }

    .summary {
      background-color: #f1f1f1;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }

    .confirm-message {
      background-color: #d4edda;
      padding: 20px;
      border-radius: 10px;
      color: #155724;
      text-align: center;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

<div class="container">

  <header>
    <img src="Agencee_Logo_png.png" alt="Agencee Logo" />
  </header>

  <!-- Pagina 1: Servizio -->
  <div id="page1">
    <h1>Scegli il Servizio</h1>
    <label class="label">Servizio</label>
    <select id="serviceSelect" class="dropdown">
      <option value="">Seleziona...</option>
      <option value="Appuntamento in sede">Appuntamento in sede</option>
      <option value="Call">Call</option>
    </select>
    <button class="button" onclick="nextPage(2)">Avanti</button>
  </div>

  <!-- Pagina 2: Calendario + Collaboratore -->
  <div id="page2" class="hidden">
    <h1>Scegli giorno e orario</h1>

    <div class="calendar-nav">
      <button onclick="prevWeek()">←</button>
      <h3 id="monthLabel">Mese</h3>
      <button onclick="nextWeek()">→</button>
    </div>

    <div class="calendar-days" id="calendarDays"></div>

    <div class="slots-list" id="slotsList"></div>

    <label class="label">Collaboratori disponibili</label>
    <select id="collaboratorSelect" class="dropdown">
      <option value="">Seleziona un orario prima</option>
    </select>

    <button class="button" onclick="nextPage(3)">Avanti</button>
  </div>

  <!-- Pagina 3: Form Prenotazione -->
  <div id="page3" class="hidden">
    <h1>I tuoi dati</h1>

    <label class="label">Nome e Cognome</label>
    <input type="text" id="nameInput" class="form-input" placeholder="Mario Rossi">

    <label class="label">Email</label>
    <input type="email" id="emailInput" class="form-input" placeholder="mario@email.com">

    <label class="label">Motivo</label>
    <input type="text" id="reasonInput" class="form-input" placeholder="Motivo...">

    <div class="summary">
      <h3>Riepilogo</h3>
      <p><strong>Servizio:</strong> <span id="summaryService">-</span></p>
      <p><strong>Data:</strong> <span id="summaryDate">-</span></p>
      <p><strong>Orario:</strong> <span id="summaryTime">-</span></p>
      <p><strong>Collaboratore:</strong> <span id="summaryCollaborator">-</span></p>
    </div>

    <button class="button" onclick="nextPage(4)">Conferma Prenotazione</button>
  </div>

  <!-- Pagina 4: Conferma -->
  <div id="page4" class="hidden">
    <div class="confirm-message">
      <h2>✅ Prenotazione Confermata!</h2>
      <p>Riceverai una mail con i dettagli.</p>
    </div>
  </div>

</div>

<script>
  const backendUrl = 'https://agencee-backend.onrender.com';  // <-- questo è il link del backend
  let selectedDate = '';
  let selectedTime = '';
  let currentWeekOffset = 0;

  function nextPage(pageNumber) {
    if (pageNumber === 2 && !document.getElementById('serviceSelect').value) {
      alert('Seleziona un servizio');
      return;
    }

    if (pageNumber === 3) {
      const collaborator = document.getElementById('collaboratorSelect').value;
      if (!selectedDate || !selectedTime || !collaborator) {
        alert('Seleziona giorno, orario e collaboratore');
        return;
      }

      document.getElementById('summaryService').innerText = document.getElementById('serviceSelect').value;
      document.getElementById('summaryDate').innerText = selectedDate;
      document.getElementById('summaryTime').innerText = selectedTime;
      document.getElementById('summaryCollaborator').innerText = collaborator;
    }

    if (pageNumber === 4) {
      const name = document.getElementById('nameInput').value;
      const email = document.getElementById('emailInput').value;
      const reason = document.getElementById('reasonInput').value;

      if (!name || !email || !reason) {
        alert('Completa i tuoi dati!');
        return;
      }

      console.log('Prenotazione inviata!', {
        servizio: document.getElementById('serviceSelect').value,
        giorno: selectedDate,
        ora: selectedTime,
        collaboratore: document.getElementById('collaboratorSelect').value,
        nome: name,
        email: email,
        motivo: reason
      });
    }

    for (let i = 1; i <= 4; i++) {
      document.getElementById(`page${i}`).classList.add('hidden');
    }
    document.getElementById(`page${pageNumber}`).classList.remove('hidden');
  }

  function generateDays() {
    const daysContainer = document.getElementById('calendarDays');
    daysContainer.innerHTML = '';
    const today = new Date();
    const startDate = new Date(today);
    startDate.setDate(today.getDate() + (currentWeekOffset * 7));

    const daysOfWeek = ['lun', 'mar', 'mer', 'gio', 'ven', 'sab', 'dom'];

    for (let i = 0; i < 7; i++) {
      const date = new Date(startDate);
      date.setDate(startDate.getDate() + i);

      const dayName = daysOfWeek[i];
      const dayNum = date.getDate();
      const monthName = date.toLocaleDateString('it-IT', { month: 'long' });

      document.getElementById('monthLabel').innerText = monthName;

      const div = document.createElement('div');
      div.className = 'day';
      div.innerHTML = `<span>${dayName}</span><div class="date">${dayNum}</div>`;

      div.addEventListener('click', () => {
        selectedDate = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        document.querySelectorAll('.day').forEach(el => el.classList.remove('selected'));
        div.classList.add('selected');
        generateSlots();
      });

      daysContainer.appendChild(div);
    }
  }

  function generateSlots() {
    const slotsList = document.getElementById('slotsList');
    slotsList.innerHTML = '';

    const slots = ['09:00', '09:30', '10:00', '10:30', '11:00', '14:00', '14:30', '15:00'];

    slots.forEach(slot => {
      const div = document.createElement('div');
      div.className = 'slot-item';
      div.innerHTML = `<span>${slot}</span><span>€ 0</span>`;

      div.addEventListener('click', async () => {
        selectedTime = slot;
        document.querySelectorAll('.slot-item').forEach(el => el.classList.remove('selected'));
        div.classList.add('selected');

        await updateAvailableCollaborators();
      });

      slotsList.appendChild(div);
    });
  }

  async function updateAvailableCollaborators() {
    const collaboratorSelect = document.getElementById('collaboratorSelect');
    collaboratorSelect.innerHTML = '<option value="">Caricamento...</option>';

    if (!selectedDate || !selectedTime) return;

    try {
      const response = await fetch(`${backendUrl}/availability?date=${selectedDate}&time=${selectedTime}`);
      const data = await response.json();

      collaboratorSelect.innerHTML = '';

      if (data.availableCollaborators.length === 0) {
        collaboratorSelect.innerHTML = '<option value="">Nessun collaboratore disponibile</option>';
      } else {
        collaboratorSelect.innerHTML = '<option value="">Seleziona...</option>';
        data.availableCollaborators.forEach(name => {
          const option = document.createElement('option');
          option.value = name;
          option.text = name;
          collaboratorSelect.appendChild(option);
        });
      }
    } catch (error) {
      console.error('Errore nel recupero disponibilità:', error);
      collaboratorSelect.innerHTML = '<option value="">Errore di connessione</option>';
    }
  }

  function nextWeek() {
    currentWeekOffset++;
    generateDays();
  }

  function prevWeek() {
    currentWeekOffset--;
    generateDays();
  }

  // Init
  generateDays();
</script>

</body>
</html>

